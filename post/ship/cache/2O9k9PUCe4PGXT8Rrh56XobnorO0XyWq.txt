module.exports.config = {
	name: "diemdanh",
	version: "1.0.1",
	hasPermssion: 0,
	credits: "Kanzu",
	description: "ƒêi·ªÉm danh th√†nh vi√™n",
	commandCategory: "ùêÅùêéùêó",
	usages: "",
	cooldowns: 5,
	envConfig: {
    cooldownTime: 3000000
    }
};

module.exports.onLoad = function () {
	const fs = require("fs-extra");

	if (!fs.existsSync(__dirname + "/cache/dd.json")) {
		const diemdanh = [];
		fs.writeFileSync(__dirname + "/cache/dd.json", JSON.stringify(diemdanh));
	}
}

module.exports.run = async ({ api, event, args, permssion, Users, global, Currencies }) => {
	const fs = require("fs-extra");
	const content = args.slice(1, args.length);
	const dirFile = __dirname + "/cache/diendanh.json";

	var getList = fs.readFileSync(dirFile);
	var getData = JSON.parse(getList);
	switch (args[0]) {
		case "add": {
			return api.sendMessage(`Ch·ªâ c·∫ßn d√πng /diemdanh th√¥i nh√° kh√¥ng c·∫ßn d√πng /diemdanh add n·ªØa`, event.threadID, event.messageID);
		}
		case "delete":
		case "del": {
			if (permssion !== 2) return api.sendMessage("B·∫°n kh√¥ng ƒë·ªß quy·ªÅn h·∫°n ƒë·ªÉ c√≥ th·ªÉ s·ª≠ d·ª•ng delete", event.threadID, event.messageID);
			if (getData.length == 0) return api.sendMessage(`Ch∆∞a c√≥ m·ª•c n√†o c√≥ th·ªÉ x√≥a`, event.threadID, event.messageID);
			if (content.length == 0) return api.sendMessage(`B·∫°n c·∫ßn ph·∫£i ch·ªâ ƒë·ªãnh m·ª•c c·∫ßn x√≥a`, event.threadID, event.messageID);
			if (isNaN(content)) return api.sendMessage(`B·∫°n c·∫ßn ph·∫£i ch·ªâ ƒë·ªãnh m·ª•c c·∫ßn x√≥a`, event.threadID, event.messageID);
			getData.splice((parseInt(content) - 1), 1);
			fs.writeFileSync(dirFile, JSON.stringify(getData));
			return api.sendMessage(`ƒê√£ x√≥a th√†nh c√¥ng m·ª•c c√≥ ID l√†: ${content}`, event.threadID, event.messageID);
		}
		case "list":
		case "all": {
			if (getData.length == 0) return api.sendMessage(`Hi·ªán t·∫°i ch∆∞a c√≥ ai ƒëi·ªÉm danh ƒë·ªÉ hi·ªÉn th·ªã`, event.threadID, event.messageID);
			var workList = "";
			getData.map(item => workList += `\n[‚ùñ] - ${item}`);
			return api.sendMessage(`Sau ƒë√¢y l√† to√†n b·ªô ng∆∞·ªùi c√≥ m·∫∑t: ${workList}`, event.threadID, event.messageID);
		}	
		default :
			try {
		 const today = new Date().toLocaleString("vi-vn", {timeZone: "Asia/Ho_Chi_Minh"});
const nameUser = (await Users.getData(event.senderID)).name || (await Users.getInfo(event.senderID)).name;
const name = Users.getData(event.senderID).name || (await api.getUserInfo(event.senderID))[event.senderID].name;
const diemdanh = `[ ` +  today  + ` ] ‚Ä¢ `+`[ ${name} ] - [ C√ì ]`
.replace(/\{name}/g, nameUser)
		getData.push(diemdanh);
		fs.writeFileSync(dirFile, JSON.stringify(getData));
		return api.sendMessage(`ƒêi·ªÉm danh th√†nh c√¥ng`, event.threadID,event.messageID);
	}
			catch (e) {
		 		api.sendMessage("ƒê√£ x·∫£y ra l·ªói khi th·ª±c hi·ªán l·ªánh" + err, event.threadID, event.messageID);
		}
	}
}